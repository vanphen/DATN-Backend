<div class="contact1-pic js-tilt icon-chat" data-tilt="" style="will-change: transform;
      transform: perspective(300px) rotateX(0deg) rotateY(0deg);
      width: 10%;
      position: fixed;
      bottom: 15px;
      right: 15px;
      display:none;
      ">
   <img src="https://cdn3.iconfinder.com/data/icons/mixed-vol-1-3/74/1_7-512.png" alt="IMG">
</div>
<div class='banner-noti-browser'>
   <div class='banner-noti-browser__group'>
      <div class="contact1-pic js-tilt" data-tilt=""
         style="will-change: transform; transform: perspective(300px) rotateX(0deg) rotateY(0deg);">
         <img src="https://cdn3.iconfinder.com/data/icons/mixed-vol-1-3/74/1_7-512.png" alt="IMG">
      </div>
      <span class='banner-noti-browser__title'>Đừng bỏ lỡ những thông tin hữu ích , chúng tôi sẵn sàng phục vụ bạn
         !</span>
   </div>
   <div class='flx flx-al-c banner-noti-browser__group-btn'>
      <button
         class='button button-default button-medium clickable banner-noti-browser__group-btn__turn-on button-chat'><span><a
               style='color:#ffffff'>Chat với tư vấn viên</a></span></button>
      <button class='button button-default button-medium clickable banner-noti-browser__group-btn__cancel'
         id='longanit'><span>Chào tạm biệt</span></button>
   </div>
</div>
<form class="contact1-form  validate-form" style="
      background: linear-gradient(rgba(43, 119, 190, 0.94), rgb(74, 121, 206));
      right: 30px;
      border-radius: 13px;
      bottom: 40px;
      width: 318px;
      height: 429px;
      position: fixed;
      display: none
      ">
   <a class="close"><i class="fa fa-times fa-2x"></i></a>
   <span class="contact1-form-title" style="
     color: #ffffff;
     font-size: 30px;
     margin-left: 20px;">
      Thông tin của bạn
   </span>
   <div class="form-chat" style="
         padding-right: 20px;
         padding-left: 20px;
         margin-top: 10px;
         margin-bottom: 10px;
   ">
      <div class="wrap-input1 form-group validate-input " data-validate="Name is required">
         <input class="form-control input1" type="text" required name="name" placeholder="Tên của bạn">
         <span class="shadow-input1"></span>
      </div>
      <div class="wrap-input1 form-group validate-input " data-validate="Valid email is required">
         <input class="form-control input1" type="text" required name="email" placeholder="Tài khoản email">
         <span class="shadow-input1"></span>
      </div>
      <div class="wrap-input1 form-group validate-input " data-validate="Valid phone is required">
         <input class="form-control input1" type="text" required name="phone" placeholder="SĐT (chat online có  thể trống)">
         <span class="shadow-input1"></span>
      </div>
      <div class="wrap-input1 form-group validate-input " data-validate="Valid email is required">
         <textarea  class="form-control input1" name="content" placeholder="Nội dung cần tư vấn (chat online có thể trống)"></textarea>
         <span class="shadow-input1"></span>
      </div>
      <textarea style="display: none;" class="form-control input1" name="message" placeholder="Message">test</textarea>
      </div>
   </div>
   <div class="container-contact1-form-btn">
      <button type="button" class="btn btn-primary contact1-form-btn open-button" style="
     background: #0602ff;
     margin-bottom: 20px;
     margin-left: 18px;
     border-radius: 7px;
            ">
         <span>
            Chat Online
         </span>
      </button>
      <button type="button" class="btn btn-primary contact1-form-btn register-customer" style="
         background: #0602ff;
         margin-bottom: 20px;
         margin-left: 57px;
         border-radius: 7px;
         ">
      <span>
         Đăng kí tư vấn
      </span>
   </button>
   </div>
</form>

<div id="myModal" class="container" style="display: none; position: fixed;bottom: 12px;right: 15px;border-radius: 8px;">
   <div class="card">
      <div class="card-header msg_head">
         <div class="d-flex bd-highlight">
            <div class="img_cont">
               <img src="https://cdn3.iconfinder.com/data/icons/mixed-vol-1-3/74/1_7-512.png" class="rounded-circle user_img">
               <span class="online_icon"></span>
            </div>
            <div class="user_info">
               <span class="name_customer">chat với nhân viên</span>
            </div>
            <div class="video_cam">
               <span id="myBtn"><i class="fas fa-video"></i></span>
               <span id="close"><i class="fa fa-times"></i></span>
            </div>
         </div>

         <div class="action_menu">
            <ul>
               <li><i class="fas fa-user-circle"></i> View profile</li>
               <li><i class="fas fa-users"></i> Add to close friends</li>
               <li><i class="fas fa-plus"></i> Add to group</li>
               <li><i class="fas fa-ban"></i> Block</li>
            </ul>
         </div>
      </div>
      <div class="card-body msg_card_body">
         <div class="d-flex justify-content-start mb-4">
            <div class="img_cont_msg">
               <img src="https://cdn3.iconfinder.com/data/icons/mixed-vol-1-3/74/1_7-512.png"
                  class="rounded-circle user_img_msg">
            </div>
            <div class="msg_cotainer">
               Xin chào bạn Chúng tôi Có thể giúp gì cho bạn .
               <span class="msg_time"> Today</span>
            </div>
         </div>
      </div>
      <div class="card-footer">
         <div class="input-group" style="display: flex;">
            <div class="input-group-append">
               <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
            </div>
            <textarea name="" id="streamWriter" style="width: 80%;" class="form-control type_msg"
               placeholder="Type your message..."></textarea>
            <div class="input-group-append">
               <span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
            </div>
         </div>
      </div>
   </div>
</div>

<div class="modal fade" id="myModalCall" role="dialog">
   <div class="modal-dialog" style="margin-left: 360px;">
      <!-- Modal content-->
      <div class="modal-content" style="width: 1400px;height: 800px;">
         <div class="modal-body" style='background-color: rgb(0, 102, 84);height: 100%;'>
            <div class="container-fluid">
               <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md-2">
                     <div class="RoomStatusBar-1EZY">
                        <div class="roomLogo-3vlp">
                           <a href="/" aria-label="Home">
                              <div class="newLogoWrapper-1HUR">
                                 <img style="width: 100px;"
                                    src="https://tlus.edu.vn/wp-content/uploads/2018/06/LogoDHTL-300x300.png" alt=""
                                    srcset="">
                              </div>
                           </a>
                        </div>
                     </div>
                  </div>
                  <div class="col-md-4">
                     <h3 style="color:#ffffff;position: absolute;top: 27%;left: -7%;">Chăm sóc khách hàng TLU</h3>
                  </div>
               </div>
            </div>
            <div class="container-fluid">
               <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md-5">
		               <h2 style="color:white">Video Của Bạn</h2>
                     <video id='myVideo' style="border-radius: 10px;" width="100%" height="100%" controls autoplay>
                     </video>
                  </div>
                  <div class="col-md-5">
                     <h2 style="color:white">Video Của Tư Vấn Viên</h2>
			            <video id='videoOnline' style="border-radius: 10px;" width="100%" height="100%" autoplay>
                     </video>
                  </div>
                  <div class="col-md-1"></div>

               </div>
            </div>
            <div class="container-fluid" style="position: absolute;bottom: 20px;">
               <div class="row">
                  <div class="col-md-4"></div>
                  <div class="col-md-6" style="margin-left: -32px;">
                     <button class="toggle-video" style="border-radius: 14px;width: 15%;">
                        <figure class="buttonFigure-2JAN" style="margin: 0px;">
                           <div class="jstest-button-icon-wrapper buttonIconWrapper-1-pZ isOff-a-I8">
                              <svg width="25%" height="25%" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                 class="BaseIcon-nykw BaseIcon--light-32mi BaseIcon--sized-2HpV">
                                 <path clip-rule="evenodd"
                                    d="m11.4422 4h-4.88435-.00002c-.94429-.00001-1.71353-.00002-2.33805.05101-.64548.05273-1.22392.16492-1.76274.43946-.84673.43143-1.535138 1.11984-1.966568 1.96657-.27454.53882-.386728 1.11726-.4394654 1.76274-.05102602.62452-.05101716 1.39376-.05100628 2.33802v.0001 2.8843c-.00001088.9443-.00001974 1.7135.05100628 2.338.0527374.6455.1649254 1.2239.4394654 1.7628.43143.8467 1.119838 1.5351 1.966568 1.9665.53882.2746 1.11726.3868 1.76274.4395.62451.051 1.39372.051 2.33798.051h.00012 4.88422.0001c.9443 0 1.7135 0 2.338-.051.6455-.0527 1.2239-.1649 1.7628-.4395.8467-.4314 1.5351-1.1198 1.9665-1.9665.2746-.5389.3868-1.1173.4395-1.7628.0026-.032.0051-.0643.0074-.0971l4.4624 3.1874c.6618.4728 1.5812-.0003 1.5812-.8137v-12.11363c0-.81337-.9194-1.2865-1.5812-.81373l-4.4624 3.18737c-.0023-.03272-.0048-.06507-.0074-.09703-.0527-.64548-.1649-1.22392-.4395-1.76274-.4314-.84673-1.1198-1.53514-1.9665-1.96657-.5389-.27454-1.1173-.38673-1.7628-.43946-.6245-.05103-1.3937-.05102-2.338-.05101zm-8.07718 2.27248c.20988-.10693.49583-.18548 1.01762-.22812.53347-.04358 1.22077-.04436 2.21736-.04436h4.8c.9966 0 1.6839.00078 2.2174.04436.5218.04264.8077.12119 1.0176.22812.4704.23969.8528.62214 1.0925 1.09254.107.20988.1855.49583.2281 1.01762.0436.53347.0444 1.22077.0444 2.21736v2.8c0 .9966-.0008 1.6839-.0444 2.2174-.0426.5218-.1211.8077-.2281 1.0176-.2397.4704-.6221.8528-1.0925 1.0925-.2099.107-.4958.1855-1.0176.2281-.5335.0436-1.2208.0444-2.2174.0444h-4.8c-.99659 0-1.68389-.0008-2.21736-.0444-.52179-.0426-.80774-.1211-1.01762-.2281-.4704-.2397-.85285-.6221-1.09254-1.0925-.10693-.2099-.18548-.4958-.22812-1.0176-.04358-.5335-.04436-1.2208-.04436-2.2174v-2.8c0-.99659.00078-1.68389.04436-2.21736.04264-.52179.12119-.80774.22812-1.01762.23969-.4704.62214-.85285 1.09254-1.09254z"
                                    fill-rule="evenodd">
                                 </path>
                              </svg>
                           </div>
                           <figcaption class="buttonLegend-D6Xt">Cam</figcaption>
                        </figure>
                     </button>
                     <button class="button-volume" style="border-radius: 14px;width: 15%;">
                        <figure class="buttonFigure-2JAN" style="margin: 0px;">
                           <div class="" style="background-image: none;">
                              <svg width="25%" height="25%" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                 class="BaseIcon-nykw BaseIcon--light-32mi BaseIcon--sized-2HpV">
                                 <path clip-rule="evenodd"
                                    d="m8 13c0 1.1046.89543 2 2 2h4c1.1046 0 2-.8954 2-2v-8c0-2.20914-1.7909-4-4-4-2.20914 0-4 1.79086-4 4zm-3-3.5c.55228 0 1 .44771 1 1v3.5c0 1.6569 1.34315 3 3 3h3 3c1.6569 0 3-1.3431 3-3v-3.5c0-.55229.4477-1 1-1s1 .44771 1 1v3.5c0 2.7614-2.2386 5-5 5h-2v3c0 .5523-.4477 1-1 1s-1-.4477-1-1v-3h-2c-2.76142 0-5-2.2386-5-5v-3.5c0-.55229.44772-1 1-1z"
                                    fill-rule="evenodd"></path>
                              </svg>
                           </div>
                           <figcaption class="buttonLegend-D6Xt">Mic</figcaption>
                        </figure>
                     </button>
                     <button class="button-share" style="border-radius: 14px;width: 15%;">
                        <figure class="buttonFigure-2JAN" style="margin: 0px;">
                           <div class="buttonIconWrapper-1-pZ">
                              <svg width="25%" height="25%" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                 class="BaseIcon-nykw BaseIcon--sized-2HpV BaseIcon--light-32mi">
                                 <path clip-rule="evenodd"
                                    d="m16.4422 2h-8.88435-.00002c-.94429-.00001-1.71352-.00002-2.33805.05101-.64548.05273-1.22392.16492-1.76274.43946-.84673.43143-1.53514 1.11984-1.96657 1.96657-.27454.53882-.38673 1.11726-.43946 1.76274-.051029.62452-.051021 1.39376-.05101 2.33805v.00002 2.88435c-.000011.9443-.000019 1.7135.05101 2.338.05273.6455.16492 1.2239.43946 1.7628.43143.8467 1.11984 1.5351 1.96657 1.9665.53882.2746 1.11726.3868 1.76274.4395.62451.051 1.39372.051 2.33798.051h.00012 1.64212l-2.29017 2.8627c-.36666.4583-.04034 1.1373.54661 1.1373h9.08716c.5869 0 .9132-.679.5466-1.1373l-2.2902-2.8627h1.6421.0001c.9443 0 1.7135 0 2.338-.051.6455-.0527 1.2239-.1649 1.7628-.4395.8467-.4314 1.5351-1.1198 1.9665-1.9665.2746-.5389.3868-1.1173.4395-1.7628.051-.6245.051-1.3937.051-2.338v-2.88437c0-.94429 0-1.71353-.051-2.33805-.0527-.64548-.1649-1.22392-.4395-1.76274-.4314-.84673-1.1198-1.53514-1.9665-1.96657-.5389-.27454-1.1173-.38673-1.7628-.43946-.6245-.05103-1.3937-.05102-2.338-.05101zm-12.07718 2.27248c.20988-.10693.49583-.18548 1.01762-.22812.53347-.04358 1.22077-.04436 2.21736-.04436h8.8c.9966 0 1.6839.00078 2.2174.04436.5218.04264.8077.12119 1.0176.22812.4704.23969.8528.62214 1.0925 1.09254.107.20988.1855.49583.2281 1.01762.0436.53347.0444 1.22077.0444 2.21736v2.8c0 .9966-.0008 1.6839-.0444 2.2174-.0426.5218-.1211.8077-.2281 1.0176-.2397.4704-.6221.8528-1.0925 1.0925-.2099.107-.4958.1855-1.0176.2281-.5335.0436-1.2208.0444-2.2174.0444h-8.8c-.99659 0-1.68389-.0008-2.21736-.0444-.52179-.0426-.80774-.1211-1.01762-.2281-.4704-.2397-.85285-.6221-1.09254-1.0925-.10693-.2099-.18548-.4958-.22812-1.0176-.04358-.5335-.04436-1.2208-.04436-2.2174v-2.8c0-.99659.00078-1.68389.04436-2.21736.04264-.52179.12119-.80774.22812-1.01762.23969-.4704.62214-.85285 1.09254-1.09254z"
                                    fill-rule="evenodd"></path>
                              </svg>
                           </div>
                           <figcaption class="buttonLegend-D6Xt">Share</figcaption>
                        </figure>
                     </button>
                     <button class="button-chat" style="border-radius: 14px;width: 15%;">
                        <figure class="buttonFigure-2JAN" style="margin: 0px;">
                           <div class="buttonIconWrapper-1-pZ">
                              <svg width="25%" height="25%" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                 class="BaseIcon-nykw BaseIcon--sized-2HpV BaseIcon--light-32mi">
                                 <path clip-rule="evenodd"
                                    d="m14.6649 1.00001-.1649.00002h-4.99997l-.16486-.00002c-1.702-.000213-2.74433-.000346-3.63001.21795-2.7067.66715-4.820053 2.7805-5.487196 5.4872-.21829784.88568-.21816623 1.92802-.2179507 3.63004l.00001526.1648-.00001526.1649c-.00021553 1.702-.00034714 2.7443.2179507 3.63.667143 2.7067 2.780496 4.82 5.487196 5.4872.88568.2183 1.92802.2182 3.63002.2179h.16485 2.83337l4.6667 3.5c.824.618 2 .0301 2-1v-2.9288c2.3648-.8356 4.174-2.8095 4.782-5.2763.2183-.8857.2182-1.928.2179-3.63v-.1649-.1648c.0003-1.70203.0004-2.74436-.2179-3.63004-.6671-2.7067-2.7805-4.82005-5.4872-5.4872-.8857-.218296-1.928-.218163-3.63-.21795zm-.1649 2.00002c1.9188 0 2.6976.00732 3.3163.15982 1.9849.48924 3.5347 2.03903 4.0239 4.02394.1525.6187.1598 1.39746.1598 3.31621 0 1.9188-.0073 2.6976-.1598 3.3163-.4892 1.9849-2.039 3.5347-4.0239 4.0239-.6187.1525-1.3975.1598-3.3163.1598h-4.99997c-1.91878 0-2.69754-.0073-3.31624-.1598-1.98491-.4892-3.5347-2.039-4.02394-4.0239-.1525-.6187-.15982-1.3975-.15982-3.3163 0-1.91875.00732-2.69751.15982-3.31621.48924-1.98491 2.03903-3.5347 4.02394-4.02394.6187-.1525 1.39746-.15982 3.31624-.15982zm-5.10307 6.55746c-.24452-.49521-.84418-.69844-1.33939-.45392-.4952.24452-.69843.84418-.45391 1.33943.41247.8353 1.05013 1.5388 1.84107 2.0311.7909.4924 1.7037.7539 2.6353.7552.9317.0012 1.8452-.2578 2.6374-.7479.7923-.4902 1.4319-1.192 1.8467-2.0262.2458-.49452.0443-1.09474-.4503-1.34061-.4945-.24587-1.0947-.04429-1.3406.45025-.2489.50056-.6326.92156-1.108 1.21566-.4753.2941-1.0234.4495-1.5824.4488-.559-.0008-1.1067-.1577-1.5812-.4531-.4746-.2954-.85719-.7175-1.10467-1.21871z"
                                    fill-rule="evenodd"></path>
                              </svg>
                           </div>
                           <figcaption class="buttonLegend-D6Xt">Chat</figcaption>
                        </figure>
                     </button>
                     <button class="button-leave" data-dismiss="modal" style="border-radius: 14px;width: 15%;">
                        <figure class="buttonFigure-2JAN" style="margin: 0px;">
                           <div class="buttonIconWrapper-1-pZ">
                              <svg width="25%" height="25%" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                 class="BaseIcon-nykw BaseIcon--sized-2HpV BaseIcon--meetingRed-3dxB">
                                 <path clip-rule="evenodd"
                                    d="m17.9101 6.59611c-.0247-.33383-.0916-2.08992 1.2366-2.08992 1.4268 0 1.87 1.79068 1.8936 1.89027l.0021.00928c.0786.36578.1552.71979.2295 1.06277 1.5223 7.02979 2.0416 9.42819-2.1252 13.59499-4.3668 4.3668-11.17718 1.0918-17.08286-4.807-.01142-.0114-.02279-.0223-.03454-.0333-.17816-.1679-1.651682-1.61-.72652-2.5351.98353-.9836 2.63107.664 2.63107.664l1.76846 1.7684c.2721.2721.71326.2721.98535 0 .2721-.2721.2721-.7132 0-.9853l-4.49619-4.4963c-.0064-.0064-.01197-.0121-.01807-.0188-.10483-.1149-1.1329-1.28563-.30366-2.11491.87286-.87289 2.09098.3452 2.09102.34524l4.02075 4.02077c.27151.2715.71172.2715.98322 0 .27151-.2715.27151-.7117.00001-.9832l-5.72882-5.72898c-.02271-.02271-.0462-.04398-.07005-.0655-.21048-.18988-1.24151-1.20799-.29439-2.1551.9428-.94281 1.94711.08338 2.14183.30209.02326.02613.04613.0516.07087.07634l5.46322 5.46317c.2837.28368.7437.28368 1.0274 0 .2837-.28371.2837-.74369 0-1.02741l-4.29008-4.29007c-.02347-.02347-.04761-.04527-.07235-.0674-.20963-.18753-1.20576-1.16121-.34132-2.02562.96128-.96124 2.17921.25659 2.17943.25681l.00001.00001 7.09461 7.09461c.6196.61965 1.6797.19919 1.7054-.67679.03-1.02642.0594-2.06518.0638-2.34063.0006-.03652-.0015-.07099-.0042-.10742zm-1.7613 5.81959c.2202-.1667.2635-.4803.0968-.7004-.1667-.2202-.4803-.2635-.7005-.0968-1.7516 1.3265-3.116 4.2243-1.8491 7.7871.0925.2602.3784.3962.6386.3036.2602-.0925.3961-.3784.3036-.6386-1.1199-3.1495.1045-5.5901 1.5106-6.6549z"
                                    fill-rule="evenodd"></path>
                              </svg>
                           </div>
                           <figcaption class="buttonLegend-D6Xt">Leave</figcaption>
                        </figure>
                     </button>
                  </div>
                  <div class="col-md-2"></div>
               </div>
            </div>
         </div>

      </div>
   </div>
</div>


<script>
      /////////////////////////
      var socket = io.connect("http://18.183.81.183:9000/");

      var nameRoom;
      var nameRommCurrent;
      var inforUser;


      function getInforUser() {
      let data;
      let user;
      var currentDate = new Date();
      data = $.parseJSON($.ajax({
          url: 'http://ip-api.com/json/',
          dataType: "json",
          async: false
      }).responseText);
      user = {
          'country': data['country'],
          'city': data['city'],
          'timezone': data['timezone'],
          'ip': data['query'],
          'created_at': currentDate,
      }
      return user;
      }

      socket.on('connect', async function() {
      let inforUser = await getInforUser();
      if (sessionStorage.getItem('nameGroup')) {
          inforUser['nameGroup'] = sessionStorage.getItem('nameGroup')
      }
      if (sessionStorage.getItem('userID')) {
          inforUser['userID'] = sessionStorage.getItem('userID')
      }
      socket.emit('them_thanh_vien', 'userchat', inforUser);
      });


      socket.on('thong_bao', function(server, id, nameRooms) {
      nameRoom = JSON.parse(nameRooms);
      nameRommCurrent = nameRoom[id]['nameRoom'];
      sessionStorage.setItem('nameGroup', nameRommCurrent);
      sessionStorage.setItem('userID', id);
      });

      socket.on('my_message', function(object_message) {
      let new_message = JSON.parse(object_message);
      if (new_message.userID != 3) {
          nameRommCurrent = new_message.nameRoom
          var currentDate = new Date();
          var currentDatechat = currentDate.getHours() + ':' + currentDate.getMinutes();
          var ampm = currentDate.getHours() >= 12 ? 'PM' : 'AM';
          $('.msg_card_body').append(`<div class="d-flex justify-content-start mb-4"> <div class="img_cont_msg"> <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg"  class="rounded-circle user_img_msg">  </div> <div class="msg_cotainer">  ${new_message.message} .<span class="msg_time">${currentDatechat} ${ampm},Today</span></div></div>`);
          $(".msg_card_body").stop().animate({
              scrollTop: $(".msg_card_body")[0].scrollHeight
          }, 1000);
      }
      })


      $('textarea#streamWriter').keydown(function(e) {
      if (e.keyCode === 13 && e.ctrlKey) {
          $(this).val(function(i, val) {
              return val + "\n";
          });
      }
      }).keypress(function(e) {
      if (e.keyCode === 13 && !e.ctrlKey) {
          sendMessage();
          return false;
      }
      });

      function sendMessage() {
          let contentChat = $('textarea#streamWriter').val().trim();
          var currentDate = new Date();
          var currentDatechat = currentDate.getHours() + ':' + currentDate.getMinutes();
          var ampm = currentDate.getHours() >= 12 ? 'PM' : 'AM';
          if (contentChat) {
              $('.msg_card_body').append(`<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">${contentChat}<span class="msg_time_send">${currentDatechat},${ampm} </span></div><div class="img_cont_msg"><img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg"></div></div>`);
              $(".msg_card_body").stop().animate({
                  scrollTop: $(".msg_card_body")[0].scrollHeight
              }, 1000);
              $('textarea#streamWriter').val('');
              let newmessage = {
                  nameRoom: nameRommCurrent,
                  username: 'userchat',
                  message: contentChat,
                  userID: 3,
              }
              socket.emit('new_message', JSON.stringify(newmessage));
          }
      }
      $('.input-group-append').click(function() {
        sendMessage();
      })

      $('#longanit').click(function() {
          $('.banner-noti-browser').fadeOut(500);
          $('.icon-chat').fadeIn()
      })



      // cal video
      var stream;
      var yourConn;


      $("#myBtn").click(function() {
      $("#myModalCall").modal({
          backdrop: 'static',
          keyboard: false
      });
      $('#myModal').hide();
      $('.icon-chat').fadeIn();
      });

      socket.on('new_call', function(object_new_call) {
      new_call = JSON.parse(object_new_call);
      // new_call = object_new_call;
      if (new_call.userID != 3) {
          let anwser_calling = true;
          if (confirm('bạn có cuộc gọi từ tư vấn viên')) {
              $("#myModalCall").modal({
                  backdrop: 'static',
                  keyboard: false
              });
              $('#myModal').hide();
              $('.icon-chat').fadeIn();
              loadVideoLocal();
          } else {
              anwser_calling = true;
              $("#myModalCall").modal({
                  backdrop: 'static',
                  keyboard: false
              });
              $('#myModal').hide();
              $('.icon-chat').fadeIn();
              loadVideoLocal();
          }
          let anser_new_call = {
              nameRoom: new_call.nameRoom,
              calling: anwser_calling,
              action: new_call.action,
              userID: 3,
          }
          sendMessageCall(anser_new_call)
      }
      })




      function sendMessageCall(object_mess) {
      socket.emit(object_mess.action, JSON.stringify(object_mess));
      // socket.emit(object_mess.action, object_mess);
      }

      function loadVideoLocal() {
      if (hasUserMedia()) {
          var constraints = {
              video: true,
              audio: true,
          };

          var configuration = {
              'iceServers': [{
                      'url': 'stun:stun.l.google.com:19302'
                  },
                  {
                      'url': 'turn:192.158.29.39:3478?transport=udp',
                      'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',
                      'username': '28224511:1379330808'
                  },
                  {
                      'url': 'turn:192.158.29.39:3478?transport=tcp',
                      'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',
                      'username': '28224511:1379330808'
                  }
              ]
          };

          yourConn = new webkitRTCPeerConnection(configuration);
          var video = document.querySelector('video#myVideo');
          var remoteVideo = document.querySelector('#videoOnline')
          //when a remote user adds stream to the peer connection, we display it
          yourConn.onaddstream = function(event) {
              // remoteAudio.srcObject = event.stream;
              console.log("stream",event.stream);
              console.log(remoteVideo);
              console.log(remoteVideo.srcObject);
              remoteVideo.srcObject = event.stream;

          }

          // Setup ice handling
          yourConn.onicecandidate = function(event) {
              if (event.candidate) {
                  sendMessageCall({
                      nameRoom: nameRommCurrent,
                      action: 'send_candidate',
                      userID: 3,
                      data: event.candidate,
                  });
              }
          }


          // var localAudio = document.querySelector('#localAudio');
          // var remoteAudio = document.querySelector('#remoteAudio');

          navigator.webkitGetUserMedia(constraints, function(mediaStream) {
              video.srcObject = mediaStream;
              yourConn.addStream(mediaStream)
              console.log("add stream");
              $('.toggle-video').css('background', '#00adff')
          }, function(error) {
              console.log(error);
          });
      } else {
          alert("Rất xin lỗi bạn !. Trình duyệt chưa hỗ trợ");
      }

      }

      function hasUserMedia() {
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
          navigator.mozGetUserMedia || navigator.msGetUserMedia;
      return !!navigator.getUserMedia;
      }


      $('.button-leave').click(function() {
          // remoteAudio.src = null;
          stream.srcObject = null;
          let tracks = stream.getTracks();
          tracks.forEach(function(track) {
              track.stop();
          });
          stream = null;
          yourConn.close();
          yourConn.onicecandidate = null;
          yourConn.onaddstream = null;
          })

          socket.on('send_offer', function(object_send_offer) {
          send_offer = JSON.parse(object_send_offer);
          // send_offer = object_send_offer;
          if (send_offer.userID != 3) {
              handleOffer(send_offer.nameRoom, send_offer.data);
          }
      })

      function handleOffer(nameRoom, offer) {
      console.log(yourConn);
      yourConn.setRemoteDescription(new RTCSessionDescription(offer));
      yourConn.createAnswer(function(answer) {
          yourConn.setLocalDescription(answer);
          sendMessageCall({
              nameRoom: nameRoom,
              action: 'send_answer',
              userID: 3,
              data: answer,
          })
      }, function(error) {
          alert("Error when creating an answer");
      });
      }

      socket.on('send_candidate', function(object_send_candidate) {
      send_candidate = JSON.parse(object_send_candidate);
      // send_candidate = object_send_candidate;
      if (send_candidate.userID != 3) {
          yourConn.addIceCandidate(new RTCIceCandidate(send_candidate.data));
      }
      })

      function handleCandidate(candidate) {
      yourConn.addIceCandidate(new RTCIceCandidate(candidate));
      }



      // $('.toggle-video').click(function () {
      //    $('#myVideo')[0].srcObject = null;
      //    $('.toggle-video').css('background', '#fffcfc')
      // });

      $('.button-share').click(function() {
      var displayMediaStreamConstraints = {
         video: true,
         audio: true,
      };
      if (navigator.mediaDevices.getDisplayMedia) {
         navigator.mediaDevices.getDisplayMedia(displayMediaStreamConstraints)
            .then(function (mediaStream) {
               var video = document.querySelector('video#myVideo');
               video.srcObject = mediaStream;
               video.onloadedmetadata = function (e) {
                  video.play();
               };
               $('.toggle-video').css('background', '#fffcfc')
            })
            .catch(function (err) { console.log(err.name + ": " + err.message); });
      } else {
         navigator.getDisplayMedia(displayMediaStreamConstraints).then(success).catch(error);
      }
      });


      var checkLoad = true;
      $('.open-button').on('click', function(e) {
      e.preventDefault();
      var customer = {
          'name': $('.validate-input input[name="name"]').val().trim(),
          'email': $('.validate-input input[name="email"]').val().trim(),
      };
      for (let key in customer) {
          console.log(111, key)
          if (!customer[key] && key !== 'phone' && key !== 'content') {
              alert(key + ' không được để trống');
              return;
          }
          if (key == 'email') {
              if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(customer[key]) == false) {
                  alert('Email không đúng định dạng');
                  return;
              }
          }
      }
      sessionStorage.setItem('customer', JSON.stringify({
          name: customer['name'],
          email: customer['email'],
      }));

      $('.validate-form').hide();
      $('#myModal').fadeIn(500);
      $('.name_customer').text(customer['name'])
      });


      $('.button-chat').on('click', function() {
      let userName = JSON.parse(sessionStorage.getItem('customer'));
      $('.banner-noti-browser').hide();
      if (!sessionStorage.getItem('customer')) {
          $('.validate-form').fadeIn(500);
      } else {
          $('.name_customer').text(userName['nameUser'])
          $('#myModal').fadeIn(500);
          if (checkLoad) {
              addMessage();
              checkLoad = false;
          }
      }
      })
      // Nếu click bên ngoài đối tượng container thì ẩn nó đi
      $('.close').click(function(e) {
      $('.validate-form').fadeOut(500);
      $('.icon-chat').fadeIn(500);
      })
      $('#close').click(function() {
      $('#myModal').hide();
      $('.banner-noti-browser').fadeIn(500);
      });
      $('.icon-chat').click(function() {
      $('.icon-chat').hide()
      let userName = JSON.parse(sessionStorage.getItem('customer'));

      if (!sessionStorage.getItem('customer')) {
          $('.validate-form').fadeIn(500);
      } else {
          $('.name_customer').text(userName['name'])
          $('#myModal').fadeIn(500);
          if (checkLoad) {
              addMessage();
              checkLoad = false;
          }
      }
      })

      $('.register-customer').on('click', function(e) {
      e.preventDefault();
      // dang ki tu van
      let inforCustomer = getInforUser();
      var customer = {
          'name': $('.validate-input input[name="name"]').val().trim(),
          'email': $('.validate-input input[name="email"]').val().trim(),
          'phone': $('.validate-input input[name="phone"]').val().trim(),
          'content': $('.validate-input textarea[name="content"]').val(),
          'address': inforCustomer['city'],
          'ip': inforCustomer['ip'],
      };
      for (let key in customer) {
          if (!customer[key] && key !== 'phone' && key !== 'content') {
              alert(key + ' không được để trống');
              return;
          }
          if (key == 'email') {
              if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(customer[key]) == false) {
                  alert('Email không đúng định dạng');
                  return;
              }
          }
      }
      // dang ki tu van
      sessionStorage.setItem('customer', JSON.stringify({
          name: customer['name'],
          email: customer['email'],
      }));
      socket.emit('register_customer', JSON.stringify(customer));
      alert('cảm ơn bạn đã đăng kí tư vấn dịch vụ của chúng tôi');
      $('.validate-form').fadeOut(500);
      $('.banner-noti-browser').fadeIn(500);
      });

      function addMessage() {
      if (sessionStorage.getItem('nameGroup')) {
          socket.emit('get_message_zooms', sessionStorage.getItem('nameGroup'));
          socket.on('get_message_zoom', function(listMessage) {
              listMessages = JSON.parse(listMessage)
              listMessages.forEach(element => {
                  if (element.user_id == 3) {
                      $('.msg_card_body').append(`<div class="msg-chat d-flex justify-content-end mb-4"><div class="msg_cotainer_send">${element.content}<span class="msg_time_send">today </span></div><div class="img_cont_msg"><img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg"></div></div>`);

                  } else {
                      $('.msg_card_body').append(`<div class="msg-chat d-flex justify-content-start mb-4"> <div class="img_cont_msg"> <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg"  class="rounded-circle user_img_msg">  </div> <div class="msg_cotainer">  ${element.content} .<span class="msg_time">Today</span></div></div>`);
                  }
              });
          })
      }
      }
</script>
